exports.id=484,exports.ids=[484],exports.modules={6279:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{H:()=>g,a:()=>u});var o=r(997),c=r(6689),s=r(5211),i=r(401),n=r(66),l=e([s,i,n]);[s,i,n]=l.then?(await l)():l;let d=(0,c.createContext)(void 0),u=()=>{let e=(0,c.useContext)(d);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},g=({children:e})=>{let[t,r]=(0,c.useState)(null),[a,l]=(0,c.useState)(!0),u=(0,i.getAuth)(n.l2);(0,c.useEffect)(()=>{let e=(0,s.ts)();r(e);let t=(0,i.onAuthStateChanged)(u,e=>{if(l(!0),e){let e=(0,s.ts)();r(e)}else r(null);l(!1)});return l(!1),()=>t()},[u]);let g=async(e,t)=>{l(!0);try{let a=await (0,s.x4)(e,t);return a.success&&a.user&&r(a.user),l(!1),{success:a.success,message:a.message,emailVerified:a.emailVerified}}catch(e){return l(!1),{success:!1,message:"An error occurred during login"}}},y=async(e,t,a)=>{l(!0);try{let o=await (0,s.z2)(e,t,a);return o.success&&o.user&&r(o.user),l(!1),{success:o.success,message:o.message,emailVerificationSent:o.emailVerificationSent}}catch(e){return l(!1),{success:!1,message:"An error occurred during registration"}}};return o.jsx(d.Provider,{value:{user:t,isLoading:a,isAuthenticated:!!t,login:g,register:y,logout:()=>{(0,s.kS)(),r(null)}},children:e})};a()}catch(e){a(e)}})},7024:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{R:()=>n,U:()=>d});var o=r(997),c=r(6689),s=r(5790),i=e([s]);s=(i.then?(await i)():i)[0];let l=(0,c.createContext)(void 0);function n({children:e}){let[t,r]=(0,c.useState)([]),[a,i]=(0,c.useState)(!0),[n,d]=(0,c.useState)(null),[u,g]=(0,c.useState)(Date.now()),y=(0,c.useCallback)(async()=>{try{i(!0);let e=await (0,s.Ej)();r(e),d(null),g(Date.now())}catch(e){d(e.message||"Failed to load banners"),console.error("Error loading banners:",e)}finally{i(!1)}},[]);(0,c.useEffect)(()=>{},[y]);let h=(0,c.useMemo)(()=>{let e={};return t.forEach(t=>{e[t.page]||(e[t.page]=[]),e[t.page].push(t)}),Object.keys(e).forEach(t=>{e[t].sort((e,t)=>e.order-t.order)}),e},[t,u]),m=(0,c.useCallback)(async e=>{if(h[e])return h[e];try{return await (0,s.rP)(e)}catch(t){return console.error(`Error getting banners for page ${e}:`,t),[]}},[h]),p=(0,c.useCallback)(async e=>{try{let t=await (0,s.ON)(e);return await y(),t}catch(e){throw d(e.message||"Failed to add banner"),e}},[y]),f=(0,c.useCallback)(async(e,t)=>{try{await (0,s.Bt)(e,t),await y()}catch(e){throw d(e.message||"Failed to update banner"),e}},[y]),w=(0,c.useCallback)(async e=>{try{await (0,s.H_)(e),await y()}catch(e){throw d(e.message||"Failed to delete banner"),e}},[y]),b=(0,c.useCallback)(async()=>{await y()},[y]),C=(0,c.useMemo)(()=>({banners:t,loading:a,error:n,getBannersForPage:m,addNewBanner:p,updateExistingBanner:f,removeBanner:w,refreshBanners:b}),[t,a,n,m,p,f,w,b]);return o.jsx(l.Provider,{value:C,children:e})}let d=()=>{let e=(0,c.useContext)(l);if(void 0===e)throw Error("useBanners must be used within a BannerProvider");return e};a()}catch(e){a(e)}})},4796:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i,j:()=>s});var a=r(997),o=r(6689);let c=(0,o.createContext)(void 0),s=()=>{let e=(0,o.useContext)(c);if(!e)throw Error("useCart must be used within a CartProvider");return e},i=({children:e})=>{let[t,r]=(0,o.useState)([]),[s,i]=(0,o.useState)([]),[n,l]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{},[]),(0,o.useEffect)(()=>{},[t,s,n]),a.jsx(c.Provider,{value:{cart:t,wishlist:s,addToCart:(e,t=1,a,o)=>{let c=a??(e.sizes&&e.sizes.length>0?e.sizes[0]:""),s=o||(e.colors?e.colors[0]:void 0);r(r=>{let a=r.findIndex(t=>t.product.id===e.id&&t.size===c&&(!t.color&&!s||t.color?.code===s?.code));if(!(a>=0))return[...r,{product:e,quantity:t,size:c,color:s}];{let e=[...r];return e[a].quantity+=t,e}})},removeFromCart:e=>{r(t=>t.filter(t=>t.product.id!==e))},updateCartItemQuantity:(e,t)=>{r(r=>r.map(r=>r.product.id===e?{...r,quantity:Math.max(1,t)}:r))},clearCart:()=>{r([])},getCartTotal:()=>t.reduce((e,t)=>e+t.product.price*t.quantity,0),getCartCount:()=>t.reduce((e,t)=>e+t.quantity,0),toggleWishlist:e=>{i(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])},isInWishlist:e=>s.some(t=>t.id===e)},children:e})}},1784:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{G:()=>d,r:()=>l});var o=r(997),c=r(6689),s=r(5200),i=e([s]);s=(i.then?(await i)():i)[0];let n=(0,c.createContext)(void 0),l=()=>{let e=(0,c.useContext)(n);if(!e)throw Error("useProducts must be used within a ProductProvider");return e},d=({children:e})=>{let[t,r]=(0,c.useState)([]),[a,i]=(0,c.useState)([]),[l,d]=(0,c.useState)({}),[u,g]=(0,c.useState)(!0),[y,h]=(0,c.useState)(null),m=(0,c.useCallback)(e=>{let t={};e.forEach(e=>{e.category&&(t[e.category]||(t[e.category]=[]),t[e.category].push(e))}),d(t)},[]),p=(0,c.useCallback)(async()=>{try{g(!0),h(null);let e=await s.getAllProducts();r(e),m(e)}catch(e){console.error("Error fetching products:",e),h(e.message||"Failed to load products. Please try again later.")}finally{g(!1)}},[m]);(0,c.useEffect)(()=>{p()},[p]);let f=(0,c.useCallback)(e=>l[e]||[],[l]),w=async e=>{try{if(h(null),!e.category)throw Error("Product category is required");let t=await s.addProduct(e);return r(e=>[...e,t]),d(r=>{let a={...r},o=e.category;return a[o]||(a[o]=[]),a[o]=[...a[o],t],a}),t}catch(e){throw console.error("Error adding product:",e),h(e.message||"Failed to add product"),e}},b=async(e,a)=>{try{h(null);let o=t.find(t=>t.id===e);if(!o)throw Error("Product not found");await s.updateProduct(e,a);let c={...o,...a};r(t=>t.map(t=>t.id===e?c:t)),a.category&&o.category!==a.category?await p():d(t=>{let r=o.category;return r&&t[r]?{...t,[r]:t[r].map(t=>t.id===e?c:t)}:t})}catch(e){throw console.error("Error updating product:",e),h(e.message||"Failed to update product"),e}},C=async e=>{try{h(null);let a=t.find(t=>t.id===e);if(!a)throw Error("Product not found");await s.deleteProduct(e),r(t=>t.filter(t=>t.id!==e)),a.category&&d(t=>{let r={...t};return r[a.category]&&(r[a.category]=r[a.category].filter(t=>t.id!==e),0===r[a.category].length&&delete r[a.category]),r})}catch(e){throw console.error("Error removing product:",e),h(e.message||"Failed to delete product"),e}},E=async e=>{try{return h(null),await s.uploadProductImage(e)}catch(e){throw console.error("Error uploading image:",e),h(e.message||"Failed to upload image"),e}},v=async()=>{await p()};return o.jsx(n.Provider,{value:{products:t,categories:a,productsByCategory:l,loading:u,error:y,addNewProduct:w,updateExistingProduct:b,removeProduct:C,uploadImage:E,refreshProducts:v,getProductsInCategory:f},children:e})};a()}catch(e){a(e)}})},1484:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>y});var o=r(997);r(6764),r(2675),r(9187);var c=r(6689),s=r(1163),i=r(6279),n=r(1784),l=r(4796),d=r(7024),u=r(2079),g=e([i,n,d]);[i,n,d]=g.then?(await g)():g;let y=function({Component:e,pageProps:t}){let[r,a]=(0,c.useState)(!1),g=(0,s.useRouter)();return(0,c.useEffect)(()=>{a(!0);let e=(0,u.ju)(),t=()=>{setTimeout(()=>{(0,u.wL)()},100)};return g.events.on("routeChangeComplete",t),()=>{e&&e.disconnect(),g.events.off("routeChangeComplete",t)}},[g.events]),o.jsx("div",{suppressHydrationWarning:!0,className:"page-transition",children:o.jsx(i.H,{children:o.jsx(n.G,{children:o.jsx(l.Z,{children:o.jsx(d.R,{children:o.jsx(e,{...t})})})})})})};a()}catch(e){a(e)}})},2079:(e,t,r)=>{"use strict";r.d(t,{ju:()=>a,wL:()=>o});let a=()=>null,o=()=>{}},5211:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{kS:()=>g,ts:()=>l,x4:()=>d,z2:()=>u});var o=r(66),c=r(401),s=e([o,c]);[o,c]=s.then?(await s)():s;let i=(0,c.getAuth)(o.l2),n="nikhilsJeansAuthToken",l=()=>null,d=async(e,t)=>{try{let r=(await (0,c.signInWithEmailAndPassword)(i,e,t)).user,a=await r.getIdToken();if(localStorage.setItem(n,a),!r.emailVerified){let t={id:r.uid,name:r.displayName||e.split("@")[0],email:r.email||e,emailVerified:!1};return{success:!0,message:"Login successful, but please verify your email",user:t,emailVerified:!1}}let o={id:r.uid,name:r.displayName||e.split("@")[0],email:r.email||e,emailVerified:!0};return{success:!0,message:"Login successful",user:o,emailVerified:!0}}catch(t){console.error("Login error:",t);let e="An error occurred during login";return"auth/user-not-found"===t.code?e="No user found with this email":"auth/wrong-password"===t.code?e="Invalid password":"auth/invalid-email"===t.code?e="Invalid email address":"auth/user-disabled"===t.code?e="This account has been disabled":"auth/network-request-failed"===t.code&&(e="Network error. Please check your connection."),{success:!1,message:e}}},u=async(e,t,r)=>{try{let a=(await (0,c.createUserWithEmailAndPassword)(i,t,r)).user;await (0,c.sendEmailVerification)(a);let o=await a.getIdToken();localStorage.setItem(n,o);let s={id:a.uid,name:e||t.split("@")[0],email:a.email||t,emailVerified:!1};return{success:!0,message:"Registration successful. Please check your email to verify your account.",user:s,emailVerificationSent:!0}}catch(t){console.error("Registration error:",t);let e="An error occurred during registration";return"auth/email-already-in-use"===t.code?e="User with this email already exists":"auth/invalid-email"===t.code?e="Invalid email address":"auth/weak-password"===t.code?e="Password is too weak":"auth/network-request-failed"===t.code&&(e="Network error. Please check your connection."),{success:!1,message:e}}},g=async()=>{try{return await (0,c.signOut)(i),localStorage.removeItem(n),{success:!0,message:"Logout successful"}}catch(e){return console.error("Logout error:",e),{success:!1,message:"An error occurred during logout"}}};a()}catch(e){a(e)}})},66:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{db:()=>d,l2:()=>l,tO:()=>u});var o=r(3745),c=r(9500),s=r(1492),i=r(3392),n=e([o,c,s,i]);[o,c,s,i]=n.then?(await n)():n;let l=(0,o.getApps)().length?(0,o.getApp)():(0,o.initializeApp)({apiKey:"AIzaSyD_spb43jww6Pl9OFpIOMzg2LFrH-VbasQ",authDomain:"nikhils-jeans-website.firebaseapp.com",projectId:"nikhils-jeans-website",storageBucket:"nikhils-jeans-website.appspot.com",messagingSenderId:"89588207516",appId:"1:89588207516:web:0cfbe407bb6d7cc8764259",measurementId:"G-ZHMF1GS857"}),d=null,u=null;a()}catch(e){a(e)}})},5790:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{Bt:()=>y,Ej:()=>d,H_:()=>h,ON:()=>g,rP:()=>u});var o=r(66),c=r(1492),s=r(7025),i=e([o,c,s]);[o,c,s]=i.then?(await i)():i;let n=()=>o.db?o.db:(0,c.getFirestore)(o.l2),l=()=>(0,c.collection)(n(),"banners"),d=async()=>{try{let e=l();return(await (0,c.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("Error getting banners from Firestore:",e),Error("Failed to fetch banners")}},u=async e=>{try{let t=l(),r=(0,c.query)(t,(0,c.where)("page","==",e));return(await (0,c.getDocs)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(t){throw console.error(`Error getting ${e} banners:`,t),Error(`Failed to fetch ${e} banners`)}},g=async e=>{try{let t=await u(e.page);if(t.length>0){let e=t[0];await h(e.id)}let r={...e,createdAt:(0,c.serverTimestamp)(),updatedAt:(0,c.serverTimestamp)()},a=l();return{id:(await (0,c.addDoc)(a,r)).id,...r}}catch(e){throw console.error("Error adding banner to Firestore:",e),e}},y=async(e,t)=>{try{let r=(0,c.doc)(n(),"banners",e),a=await (0,c.getDoc)(r);if(!a.exists())throw Error("Banner not found");let o={...t,updatedAt:(0,c.serverTimestamp)()};if(t.imageUrl){let e=a.data();if(e.imageUrl&&e.imageUrl!==t.imageUrl)try{await (0,s.K)(e.imageUrl)}catch(e){console.error("Error deleting old banner image:",e)}}await (0,c.updateDoc)(r,o)}catch(e){throw console.error("Error updating banner in Firestore:",e),e}},h=async e=>{try{let t=(0,c.doc)(n(),"banners",e),r=await (0,c.getDoc)(t);if(!r.exists())throw Error("Banner not found");let a=r.data();if(await (0,c.deleteDoc)(t),a.imageUrl)try{await (0,s.K)(a.imageUrl)}catch(e){console.error("Error deleting banner image:",e)}}catch(e){throw console.error("Error deleting banner from Firestore:",e),e}};a()}catch(e){a(e)}})},7025:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{K:()=>l,x:()=>n});var o=r(66),c=r(3392),s=e([o,c]);[o,c]=s.then?(await s)():s;let i=()=>null===o.tO?(0,c.getStorage)(o.l2):o.tO,n=async e=>{try{let t=i(),r=new Date().getTime(),a=`banner_${r}_${e.name.replace(/[^a-zA-Z0-9.]/g,"_")}`,o=(0,c.ref)(t,`banner_images/${a}`);return await (0,c.uploadBytes)(o,e),await (0,c.getDownloadURL)(o)}catch(e){throw console.error("Error uploading banner image:",e),Error("Failed to upload banner image")}},l=async e=>{try{let t=i(),r=decodeURIComponent(e),a=r.indexOf("banner_images");if(-1===a){console.warn("Not a Firebase Storage URL or not in banner_images folder:",e);return}let o=r.indexOf("?",a),s=-1!==o?r.substring(a,o):r.substring(a),n=(0,c.ref)(t,s);await (0,c.deleteObject)(n),console.log("Banner image deleted successfully:",s)}catch(e){throw console.error("Error deleting banner image:",e),Error("Failed to delete banner image")}};a()}catch(e){a(e)}})},5200:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{addProduct:()=>S,clearProductCache:()=>F,db:()=>n,deleteProduct:()=>j,deleteProductImage:()=>D,getAllCategories:()=>T,getAllProducts:()=>p,getFeaturedProducts:()=>b,getImageById:()=>A,getNewArrivals:()=>C,getNextProductsPage:()=>f,getProductById:()=>E,getProductsByCategory:()=>w,storage:()=>l,updateProduct:()=>k,uploadProductImage:()=>P});var o=r(66),c=r(1492),s=r(3392),i=e([o,c,s]);[o,c,s]=i.then?(await i)():i;let n=(0,c.getFirestore)(o.l2),l=(0,s.getStorage)(o.l2),d=(0,c.collection)(n,"products"),u=(0,c.collection)(n,"categories"),g={all:null,byId:{},byCategory:{},lastFetched:0},y=e=>e.name&&"string"==typeof e.name?!e.price||isNaN(Number(e.price))?"Valid product price is required":e.category&&"string"==typeof e.category?e.image&&"string"==typeof e.image?null:"Product image is required":"Product category is required":"Product name is required",h=e=>{let t={};return Object.entries(e).forEach(([e,r])=>{null!=r&&("price"===e||"originalPrice"===e||"stock"===e?t[e]=Number(r):"sizes"===e&&"string"==typeof r?t[e]=r.split(",").map(e=>e.trim()).filter(Boolean):"featured"===e&&"string"==typeof r?t[e]="true"===r:t[e]=r)}),t.createdAt||(t.createdAt=(0,c.serverTimestamp)()),t.updatedAt=(0,c.serverTimestamp)(),t},m=()=>null!==g.all&&Date.now()-g.lastFetched<3e5,p=async(e=0)=>{try{if(m()&&0===e&&g.all)return console.log("Returning products from cache"),g.all;console.log("Fetching products from Firestore");let t=(0,c.query)(d,(0,c.orderBy)("createdAt","desc"));e>0&&(t=(0,c.query)(t,(0,c.limit)(e)));let r=(await (0,c.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()}));return 0===e&&(g.all=r,r.forEach(e=>{g.byId[e.id]=e,e.category&&(g.byCategory[e.category]||(g.byCategory[e.category]=[]),g.byCategory[e.category].push(e))}),g.lastFetched=Date.now()),console.log(`Retrieved ${r.length} products from Firestore`),r}catch(e){throw console.error("Error getting products from Firestore:",e),Error("Failed to fetch products")}},f=async(e,t=20)=>{try{let r=(0,c.query)(d,(0,c.orderBy)("createdAt","desc"),(0,c.startAfter)(e),(0,c.limit)(t)),a=(await (0,c.getDocs)(r)).docs.map(e=>({id:e.id,...e.data()}));return a.forEach(e=>{if(g.byId[e.id]=e,e.category){g.byCategory[e.category]||(g.byCategory[e.category]=[]);let t=g.byCategory[e.category].findIndex(t=>t.id===e.id);t>=0?g.byCategory[e.category][t]=e:g.byCategory[e.category].push(e)}}),a}catch(e){throw console.error("Error getting next page of products:",e),Error("Failed to fetch more products")}},w=async e=>{try{if(m()&&g.byCategory[e]&&g.byCategory[e].length>0)return console.log(`Returning ${e} products from cache`),g.byCategory[e];console.log(`Fetching ${e} products from Firestore`);let t=(0,c.query)(d,(0,c.where)("category","==",e)),r=(await (0,c.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()}));return g.byCategory[e]=r,r.forEach(e=>{g.byId[e.id]=e}),r}catch(t){throw console.error(`Error getting ${e} products:`,t),Error(`Failed to fetch ${e} products`)}},b=async(e=8)=>{try{if(m()&&g.all){let t=g.all.filter(e=>e.featured).slice(0,e);if(t.length>0)return console.log("Returning featured products from cache"),t}console.log("Fetching featured products from Firestore");let t=(0,c.query)(d,(0,c.where)("featured","==",!0),(0,c.orderBy)("createdAt","desc"),(0,c.limit)(e)),r=(await (0,c.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()}));return r.forEach(e=>{if(g.byId[e.id]=e,e.category){g.byCategory[e.category]||(g.byCategory[e.category]=[]);let t=g.byCategory[e.category].findIndex(t=>t.id===e.id);t>=0?g.byCategory[e.category][t]=e:g.byCategory[e.category].push(e)}}),r}catch(e){throw console.error("Error getting featured products:",e),Error("Failed to fetch featured products")}},C=async(e=8)=>{try{if(m()&&g.all){let t=g.all.filter(e=>e.new).slice(0,e);if(t.length>0)return console.log("Returning new arrivals from cache"),t}console.log("Fetching new arrivals from Firestore");let t=(0,c.query)(d,(0,c.where)("new","==",!0),(0,c.orderBy)("createdAt","desc"),(0,c.limit)(e)),r=(await (0,c.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()}));return r.forEach(e=>{if(g.byId[e.id]=e,e.category){g.byCategory[e.category]||(g.byCategory[e.category]=[]);let t=g.byCategory[e.category].findIndex(t=>t.id===e.id);t>=0?g.byCategory[e.category][t]=e:g.byCategory[e.category].push(e)}}),r}catch(e){throw console.error("Error getting new arrivals:",e),Error("Failed to fetch new arrivals")}},E=async e=>{try{if(g.byId[e])return console.log(`Returning product ${e} from cache`),g.byId[e];console.log(`Fetching product ${e} from Firestore`);let t=(0,c.doc)(n,"products",e),r=await (0,c.getDoc)(t);if(r.exists()){let t={id:r.id,...r.data()};return g.byId[e]=t,t}return null}catch(e){throw console.error("Error getting product:",e),Error("Failed to fetch product details")}},v=(e,t)=>{g.byId[e]&&delete g.byId[e],t&&g.byCategory[t]&&(g.byCategory[t]=g.byCategory[t].filter(t=>t.id!==e)),g.all=null},F=()=>{g.all=null,g.byId={},g.byCategory={},g.lastFetched=0},I=()=>(0,s.getStorage)(o.l2),P=async e=>{try{let t=await x(e),r=new Date().getTime(),a=`product_${r}_${e.name.replace(/[^a-zA-Z0-9.]/g,"_")}`,o=(0,c.collection)(n,"images"),s=await (0,c.addDoc)(o,{name:a,type:e.type,base64:t,createdAt:(0,c.serverTimestamp)()});return`base64://${s.id}`}catch(e){throw console.error("Error uploading image:",e),Error("Failed to upload product image")}},x=e=>new Promise((t,r)=>{let a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(a.result),a.onerror=e=>r(e)}),A=async e=>{try{console.log(`Fetching image with ID: ${e}`);let t=(0,c.doc)(n,"images",e),r=await (0,c.getDoc)(t);if(r.exists()){let t=r.data();if(!t||!t.base64)return console.error(`Image exists but has no base64 data. ID: ${e}`),"/images/placeholder.jpg";return console.log(`Successfully retrieved base64 image. ID: ${e}`),t.base64}return console.error(`Image not found with ID: ${e}`),"/images/placeholder.jpg"}catch(e){return console.error("Error getting image:",e),"/images/placeholder.jpg"}},D=async e=>{try{if(e.startsWith("base64://")){let t=e.replace("base64://",""),r=(0,c.doc)(n,"images",t);await (0,c.deleteDoc)(r),console.log("Product image deleted successfully from Firestore:",t);return}let t=I(),r=decodeURIComponent(e),a=r.indexOf("product_images");if(-1===a){console.warn("Not a Firebase Storage URL or not in product_images folder:",e);return}let o=r.indexOf("?",a),i=-1!==o?r.substring(a,o):r.substring(a),l=(0,s.ref)(t,i);await (0,s.deleteObject)(l),console.log("Product image deleted successfully from Storage:",i)}catch(e){console.error("Error deleting product image:",e)}},S=async e=>{try{console.log("Adding product to Firestore:",e);let t=y(e);if(t)throw Error(t);let r=h(e);console.log("Cleaned product data for Firestore:",r);let a=await (0,c.runTransaction)(n,async e=>{let t={id:(await (0,c.addDoc)(d,r)).id,...r},a=(0,c.doc)(u,r.category),o=await e.get(a);return o.exists()?e.update(a,{count:(o.data().count||0)+1,updatedAt:(0,c.serverTimestamp)()}):e.set(a,{id:r.category,name:r.category.charAt(0).toUpperCase()+r.category.slice(1),count:1,createdAt:(0,c.serverTimestamp)(),updatedAt:(0,c.serverTimestamp)()}),t});return g.all&&g.all.unshift(a),g.byId[a.id]=a,a.category&&(g.byCategory[a.category]||(g.byCategory[a.category]=[]),g.byCategory[a.category].unshift(a)),console.log("Product added successfully with ID:",a.id),a}catch(e){throw console.error("Error adding product to Firestore:",e),e}},k=async(e,t)=>{try{let r=(0,c.doc)(n,"products",e),a=await (0,c.getDoc)(r);if(!a.exists())throw Error("Product not found");let o=a.data(),s=h(t);if(s.updatedAt=(0,c.serverTimestamp)(),await (0,c.runTransaction)(n,async e=>{if(e.update(r,s),t.category&&o.category!==t.category){let r=(0,c.doc)(u,o.category),a=await e.get(r);if(a.exists()){let t=a.data().count||0;t>1?e.update(r,{count:t-1,updatedAt:(0,c.serverTimestamp)()}):e.delete(r)}let s=(0,c.doc)(u,t.category),i=await e.get(s);i.exists()?e.update(s,{count:(i.data().count||0)+1,updatedAt:(0,c.serverTimestamp)()}):e.set(s,{id:t.category,name:t.category.charAt(0).toUpperCase()+t.category.slice(1),count:1,createdAt:(0,c.serverTimestamp)(),updatedAt:(0,c.serverTimestamp)()})}}),g.byId[e]){let r={...g.byId[e],...t};if(g.byId[e]=r,g.all){let t=g.all.findIndex(t=>t.id===e);t>=0&&(g.all[t]=r)}if(t.category&&o.category!==t.category)g.byCategory[o.category]&&(g.byCategory[o.category]=g.byCategory[o.category].filter(t=>t.id!==e)),g.byCategory[t.category]||(g.byCategory[t.category]=[]),g.byCategory[t.category].push(r);else if(t.category&&g.byCategory[t.category]){let a=g.byCategory[t.category].findIndex(t=>t.id===e);a>=0&&(g.byCategory[t.category][a]=r)}}else F()}catch(e){throw console.error("Error updating product:",e),Error("Failed to update product")}},j=async e=>{try{let t=(0,c.doc)(n,"products",e),r=await (0,c.getDoc)(t);if(!r.exists())throw Error("Product not found");let a=r.data();if(a.image)try{await D(a.image)}catch(e){console.error("Error deleting product image:",e)}await (0,c.runTransaction)(n,async e=>{if(e.delete(t),a.category){let t=(0,c.doc)(u,a.category),r=await e.get(t);if(r.exists()){let a=r.data().count||0;a>1?e.update(t,{count:a-1,updatedAt:(0,c.serverTimestamp)()}):e.delete(t)}}}),v(e,a.category)}catch(e){throw console.error("Error deleting product:",e),Error("Failed to delete product")}},T=async()=>{try{return(await (0,c.getDocs)(u)).docs.map(e=>e.data())}catch(e){throw console.error("Error getting categories:",e),Error("Failed to fetch categories")}};a()}catch(e){a(e)}})},9187:()=>{},2675:()=>{},6764:()=>{}};